{{ $root := .FirstSection }}
{{ if $root }}
  <nav class="sidebar" aria-label="Navigasjon">
    <a class="sidebar__home" href="{{ $root.RelPermalink }}">{{ $root.Title }}</a>

    {{ $active := .RelPermalink }}

    <ul class="sidebar__list">
      {{ range $root.Pages.ByWeight }}
        {{ template "sidebar-item" dict "p" . "active" $active }}
      {{ end }}
    </ul>
  </nav>
{{ end }}

{{ define "sidebar-item" }}
  {{ $p := .p }}
  {{ $active := .active }}
  {{ $isActive := eq $active $p.RelPermalink }}
  {{ $isAncestor := strings.HasPrefix $active $p.RelPermalink }}

  <li class="sidebar__item">
    <a class="sidebar__link{{ if $isActive }} is-active{{ end }}" href="{{ $p.RelPermalink }}">{{ $p.Title }}</a>

    {{ if and $p.Pages (or $isActive $isAncestor) }}
      <ul class="sidebar__sublist">
        {{ range $p.Pages.ByWeight }}
          {{ template "sidebar-item" dict "p" . "active" $active }}
        {{ end }}
      </ul>
    {{ end }}
  </li>
{{ end }}
